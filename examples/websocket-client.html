<!DOCTYPE html>
<html>
<head>
    <title>Token Discovery WebSocket Client</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .event { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .category-change { background-color: #e3f2fd; }
        .aim-evaluation { background-color: #fff3e0; }
        .scan-complete { background-color: #f3e5f5; }
        .stats { background-color: #e8f5e9; }
        .passed { color: green; font-weight: bold; }
        .failed { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Token Discovery WebSocket Events</h1>
    
    <div>
        <h2>Subscribe to Channels:</h2>
        <label><input type="checkbox" id="categories" checked> Category Changes</label><br>
        <label><input type="checkbox" id="buy-signals" checked> Buy Signals</label><br>
        <label><input type="checkbox" id="scans"> Scan Complete</label><br>
        <label><input type="checkbox" id="category-stats" checked> Category Stats</label><br>
        <button onclick="updateSubscriptions()">Update Subscriptions</button>
    </div>
    
    <h2>Category Distribution:</h2>
    <div id="distribution"></div>
    
    <h2>Recent Events:</h2>
    <div id="events"></div>
    
    <script>
        const socket = io('http://localhost:3000');
        const events = document.getElementById('events');
        const maxEvents = 50;
        
        socket.on('connect', () => {
            console.log('Connected to server');
            updateSubscriptions();
        });
        
        function updateSubscriptions() {
            const channels = [];
            if (document.getElementById('categories').checked) channels.push('categories');
            if (document.getElementById('buy-signals').checked) channels.push('buy-signals');
            if (document.getElementById('scans').checked) channels.push('scans');
            if (document.getElementById('category-stats').checked) channels.push('category-stats');
            
            socket.emit('subscribe', channels);
            console.log('Subscribed to:', channels);
        }
        
        // Category change events
        socket.on('category-change', (data) => {
            addEvent(`
                <div class="event category-change">
                    <strong>Category Change:</strong> ${data.symbol} 
                    ${data.fromCategory} → ${data.toCategory} 
                    (MC: ${data.marketCap.toLocaleString()})
                </div>
            `);
        });
        
        // AIM evaluation events
        socket.on('aim-evaluation', (data) => {
            const status = data.passed ? 'passed' : 'failed';
            addEvent(`
                <div class="event aim-evaluation">
                    <strong>AIM Evaluation:</strong> ${data.symbol} 
                    <span class="${status}">${status.toUpperCase()}</span>
                    ${data.passed ? `Position: ${data.positionSize} SOL` : ''}
                </div>
            `);
        });
        
        // Scan complete events
        socket.on('scan-complete', (data) => {
            addEvent(`
                <div class="event scan-complete">
                    <strong>Scan Complete:</strong> ${data.symbol} (${data.category}) 
                    Scan #${data.scanNumber}, Next in ${data.nextScanIn}s
                </div>
            `);
        });
        
        // Category stats
        socket.on('category-stats', (data) => {
            // Update distribution display
            const dist = document.getElementById('distribution');
            dist.innerHTML = Object.entries(data.distribution)
                .map(([cat, count]) => `${cat}: ${count}`)
                .join(' | ');
            
            // Show recent transitions
            if (data.recentTransitions.length > 0) {
                const transitions = data.recentTransitions
                    .map(t => `${t.symbol}: ${t.from}→${t.to}`)
                    .join(', ');
                    
                addEvent(`
                    <div class="event stats">
                        <strong>Recent Transitions:</strong> ${transitions}<br>
                        <strong>AIM Tokens:</strong> ${data.aimTokensCount}
                    </div>
                `);
            }
        });
        
        function addEvent(html) {
            events.innerHTML = html + events.innerHTML;
            
            // Keep only last N events
            const allEvents = events.querySelectorAll('.event');
            if (allEvents.length > maxEvents) {
                for (let i = maxEvents; i < allEvents.length; i++) {
                    allEvents[i].remove();
                }
            }
        }
    </script>
</body>
</html>
